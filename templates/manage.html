<html>
<head>
<title>Monitor Manager</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>
$(document).ready(function() {
    var load_monitors_table = function() {
        $.getJSON("/manage/monitors", function(data) {
            var tbody = $("table#monitors_table tbody");
            tbody.empty();

            $.each(data.monitors, function(i, monitor) {
                var urlField = $("<input type=\"text\"/>")
                    .val(monitor.url);

                var saveButton = $("<input type=\"button\"/>")
                    .val("Save")
                    .click(function() {
                        $.ajax({
                            type: 'POST',
                            url: "/manage/monitor/" + monitor.name,
                            data: JSON.stringify({url: urlField.val()}),
                            dataType: 'json'
                        });
                    });

                var reloadButton = $("<input type=\"button\"/>")
                    .val("Reload")
                    .click(function() {
                        $.ajax({
                            type: 'POST',
                            url: "/manage/monitor/" + monitor.name + "/reload",
                            data: JSON.stringify({hard: false}),
                            dataType: 'json'
                        });
                    });

                var deleteButton = $("<input type=\"button\"/>")
                    .val("Delete")
                    .click(function() {
                        $.ajax({
                            type: 'DELETE',
                            url: "/manage/monitor/" + monitor.name,
                            success: function() {
                                load_monitors_table();
                            }
                        });
                    });

                tbody.append($("<tr/>")
                    .append($("<td/>").text(monitor.id))
                    .append($("<td/>").text(monitor.name))
                    .append($("<td/>").append(urlField))
                    .append($("<td/>")
                        .append(saveButton)
                        .append(reloadButton)
                        .append(deleteButton)
                    )
                );
            });
        });
    };

    var initMonitorCreateForm = function() {
        var form = $("div#monitor_create_form");
        form.find("input#monitor_create_submit").click(function() {
            var name = form.find("input#monitor_create_name").val();
            var url = form.find("input#monitor_create_url").val();

            $.ajax({
                type: 'PUT',
                url: "/manage/monitor/" + name,
                data: JSON.stringify({url: url}),
                dataType: 'json',
                success: function() {
                    load_monitors_table();
                }
            });
        });
    }

    load_monitors_table();
    initMonitorCreateForm();
});
</script>
</head>
<body>
    <div id="monitor_create_form">
        <strong>Create Monitor | </strong>
        <label for="monitor_create_name">Name:</label> <input id="monitor_create_name" type="text"/>
        <label for="monitor_create_url">URL:</label> <input id="monitor_create_url" type="text"/>
        <input id="monitor_create_submit" type="button" value="Save"/>
    </div>
    <table width="750px" border="1" id="monitors_table">
    <thead>
        <tr>
            <th width="15px">ID</th>
            <th>Name</th>
            <th>URL</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    </table>
</body>
</html>
